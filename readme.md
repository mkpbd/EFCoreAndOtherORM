Install Efcore

1. microsoft.entityframeworkcore
2. microsoft.entityframeworkcore.design
3. microsoft.entityframeworkcore.sqlserver
4. microsoft.entityframeworkcore.tools
5. microsoft.Extensions.Configuration
6. Microsoft.Extensions.Configuration.FileExtensions
7. Microsoft.Extensions.Configuration.Json

```csharp
//Add a default constructor if scaffolding is needed
public ApplicationDbContext() { }
//Add the complex constructor for allowing Dependency Injection
public ApplicationDbContext(DbContextOptions options)
:base(options)
{
//intentionally empty.
}
```

Adding the **DBOptions** as an injectable object to the constructor and creating the default constructor with no parameters

The name of the constructor is the exact same as the name of the class, and the new constructor has one injectable parameter of type **DbContextOptions**. This parameter will include critical information, such as the connection string to your database. Making these options injectable will ensure that the context can be used from any application pointing to any correctly configured database.

#### **Create the ability to connect and use the Database DBContext**

Add another static variable to store the options builder information. This is a **DbContextOptionsBuilder** object, which is a generic, with a type argumentn that contains the type of your generated **DbContext**

#### What is the DBContext

A **DbContext** instance represents a session with the database and can be used to query and save instances of your entities. DbContext is a combination of the unit of work and repository patterns.

Using the **DbContext**, therefore, we get orchestration around two significant patterns in database development, the unit of work (UoW) pattern, and the repository design pattern. This means that by using the DBContext, we don’t have to explicitly manage simple transactions when working with the **DBContext**, as they will be handled by the context implementing the UoW pattern.

The **DBContextOptionsBuilder** gives us a couple of critical operations that we’ll leverage. In the last chapter, we set the type of database we wanted to use and injected the connection string for the **DBContext** through the DBContextOptionsBuilder and the **DBContextOptions**

```csharp
protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
{
if (!optionsBuilder.IsConfigured)
{
var builder = new ConfigurationBuilder()
.SetBasePath(Directory.GetCurrentDirectory())
. AddJsonFile("appsettings.json", optional: true,
reloadOnChange: true);
_configuration = builder.Build();
var cnstr = _configuration.GetConnectionString("InventoryManager");
optionsBuilder.UseSqlServer(cnstr);
}
}
```

which is easily generated by creating a new ASP.Net MVC project

```csharp
public void ConfigureServices(IServiceCollection services)
{
services.AddDbContext<ApplicationDbContext>(options =>
options.UseSqlServer(
Configuration.GetConnectionString("DefaultConnection")));
services.AddDatabaseDeveloperPageExceptionFilter();
services.AddDefaultIdentity<IdentityUser>(options =>
options.SignIn.RequireConfirmedAccount = true)
.AddEntityFrameworkStores<ApplicationDbContext>();
services.AddControllersWithViews();
}
```

Important properties on the DbContextOptionsBuilder object

| Property     | Purpose                                                                                    |
| ------------ | ------------------------------------------------------------------------------------------ |
| IsConfigured | Gets a value indicating whether any options have been configured.                          |
| Options      | Gets the options being configured by giving direct access to the DBContextOptions object. |

Important properties on the DBContextOptions object

| Property    | Purpose                                                                                                                                                                    |
| ----------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ContextType | Gets the type for the context; if no type is defined, then DBContext will be returned.                                                                                     |
| Extensions  | Gets a list of extensions as configured, such as the type of database being leveraged.                                                                                    |
| IsFrozen    | Used to determine if the DBContext is open for further configuration.<br /> If true, the system cannot further override the context options in the OnConfiguring method. |
